<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Read and Record a Poem</title>
    <meta name="description"  content="">

    <!-- links to Google Fonts using the "preconnect" hint for faster load (supported by Chrome, Opera, Firefox and Android browsers) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Old+Standard+TT:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <!-- links to css files: the template contains the styles for navbar and footer; about.css contains page specific styles-->
    <link type="text/css" rel="stylesheet" href="./assets/css/template.css">
    <link type="text/css" rel="stylesheet" href="./assets/css/poem.css">

    <!-- link to the sound-up icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- link to the favicon icon -->
    <link rel="icon" type="image/x-icon" href="./assets/images/favicon.ico">
  </head>

  <body>
    <header>
        <a href="index.html">
            <h1 id="logo" >Circassian</h1>
        </a>
        <input type="checkbox" id="nav-toggle" name="nav-toggle">
        <label for="nav-toggle" class="nav-toggle-lable">X</label>

        <nav class="navbar">
            <ul id="menu">
                <li><a href="about.html" target="_blank">About</a></li>
                <li><a href="kabardian-alphabet.html" target="_blank">Kabardian Alphabet</a></li>
                <li><a href="kabardian-alphabet.html" target="_blank">Read a Poem</a></li>
                <li><a href="contact.html" target="_blank">Contact</a></li> 
            </ul>
        </nav>
    </header>

    <main>
        <div class="container">
            <div class="cell cell-1">
              <h1><span id="word1-1">Пцӏащ</span><span id="word1-2">хъуэ</span> <span id="word2-1">цӏы</span><span id="word2-2">кӏу.</span></h1>

              <h1><span id="word1-3">Pts’aś</span><span id="word1-4">xwä</span> <span id="word2-2">ts’y2</span><span id="word2-3">kw’.</span></h1>

            </br>
            <p>Гъатхэр къосри, удзхэр къокӀ.</p>
            <p>Ghatkhär q’osri, wdzkhär q’ok’.</p>
            </br>
            <p>ПцӀащхъуэ цӀыкӀухэр къолъэтэж.</p>
            <p>Pts’aśxwä ts’y2kw’khär q’olhätäzh.</p>
            </br>
            <p>ПцӀащхъуэ цӀыкӀухэр къытхуогуфӀэ,</p>
            <p>Pts’aśxwä ts’y2kw’khär q’y2tkhwogwf’ä,</p>
            </br>
            <p>ПыгуфӀыкӀхэу къытхуосыж.</p>
            <p>Py2gwf’y2k’khäw q’y2tkhwosy2zh.</p>
            </br>
            <p>ПцӀащхъуэ цӀыкӀуу зи бзэр дахэ,</p>
            <p>Pts’aśxwä ts’y2kw’w zi bzär dakhä,</p>
            </br>
            <p>Хугу уэстынщи, уэрэд жыӀэ.</p>
            <p>khwgw wästy2nśi, wäräd zhy2ä.</p>
            </br>
            <p>ЩӀыпӀэ жыжьэм щыплъэгъуахэр</p>
            <p>Ś’y2p’ä zhy2źäm śy2plhäghwakhär</p>
            </br>
            <p>Пэжагъ хэлъу къыджеӀэж.</p>
            <p>Päzhagh khälhw q’y2dzhe’äzh.</p>
            </br>
            </div>

            <div class="cell cell-2">
                <audio id="myAudio" src='./assets/audio/poem/swallow.mp3' preload="auto"></audio>
            
                <span onClick="togglePlay()" style="font-size: larger;">Listen to Native Speakers <i class="fa fa-volume-up fa-1x"></i></span>&nbsp;
                <span onClick="resetAudio()"style="font-size: larger;"><i class="fa fa-refresh" aria-hidden="true"></i></span>
                
            </div>

            <div class="cell cell-3">
                <p style="font-size: larger;">Read and Record Your Voice</p>
            </div>

          </div>

    </main>
    
    <footer>
        <small>
            Circassian 2024
        </small>
    </footer>


<script>
let myAudio = document.getElementById("myAudio");
let isPlaying = false;
let timeoutIDs = []; // array to store timeout IDs

// object to store original colours
const originalColours = {};

function togglePlay() {
    if (isPlaying) {
        myAudio.pause();
        clearTimeouts(); // clear existing timeouts when pausing
    } else {
        myAudio.play();
        const wordTimes = {
            "word1-1": 1,
            "word1-2": 2,
            "word2-1": 3,
            "word2-2": 4
        };
        Object.entries(wordTimes).forEach(([wordId, seconds]) => {
            const element = document.getElementById(wordId);
            // store original colour
            originalColours[wordId] = element.style.color;
            const timeoutID = setTimeout(function() {
                element.style.color = "#2d706c";
            }, (seconds - myAudio.currentTime) * 1000); // calculate remaining time
            timeoutIDs.push(timeoutID); // store timeout ID
        });
    }
    isPlaying = !isPlaying; // toggle isPlaying
}

// clear any existing timeouts when pausing the audio and create new timeouts when resuming the audio
function clearTimeouts() {
    // clear all stored timeouts
    timeoutIDs.forEach(id => {
        clearTimeout(id);
    });
    timeoutIDs = []; // clear the array
}

myAudio.onplaying = function() {
    isPlaying = true;
};

myAudio.onpause = function() {
    isPlaying = false;
};

function resetAudio() {
    myAudio.pause();
    myAudio.currentTime = 0;
    isPlaying = false;
    clearTimeouts(); // clear existing timeouts
    
    // restore original colours
    Object.entries(originalColours).forEach(([wordId, color]) => {
        document.getElementById(wordId).style.color = ""; // restore the default font colour
    });
}

</script>

</body>
</html>