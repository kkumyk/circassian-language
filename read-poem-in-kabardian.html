<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Read and Record a Poem</title>
    <meta name="description"  content="">

    <!-- links to Google Fonts using the "preconnect" hint for faster load (supported by Chrome, Opera, Firefox and Android browsers) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Old+Standard+TT:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- links to css files: the template contains the styles for navbar and footer; about.css contains page specific styles-->
    <link type="text/css" rel="stylesheet" href="./assets/css/template.css">
    <link type="text/css" rel="stylesheet" href="./assets/css/poem.css">

    <!-- link to the sound-up icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- link to the favicon icon -->
    <link rel="icon" type="image/x-icon" href="./assets/images/favicon.ico">
  </head>

  <body>
    <header>
        <a href="index.html">
            <h1 id="logo" >Circassian</h1>
        </a>
        <input type="checkbox" id="nav-toggle" name="nav-toggle">
        <label for="nav-toggle" class="nav-toggle-lable">X</label>

        <nav class="navbar">
            <ul id="menu">
                <li><a href="about.html" target="_blank">About</a></li>
                <li><a href="kabardian-alphabet.html" target="_blank">Kabardian Alphabet</a></li>
                <li><a href="read-poem-in-kabardian.html" target="_blank">Read and Record a Poem</a></li>
                <li><a href="contact.html" target="_blank">Contact</a></li> 
            </ul>
        </nav>
    </header>

    <main>
        <div class="container">
            <div class="cell cell-1">
                <audio id="myAudio" src='./assets/audio/poem/swallow.mp3' preload="auto"></audio>
              <h1><span id="line1-1">Пцӏащ</span><span id="line1-2">хъуэ</span> <span id="line1-3">цӏы</span><span id="line1-4">кӏу.</span>
                <span onClick="togglePlay()"><i class="fa fa-volume-up fa-1x"></i></span>
                </h1>


              <h1><span id="line2-1">Pts’aś</span><span id="line2-2">xwä</span> <span id="line2-3">ts’y2</span><span id="line2-4">kw’.</span>
                <span onClick="resetAudio()"><i class="fa fa-refresh" aria-hidden="true"></i></span>    
            </h1>

            </br>
            <!-- 
                <span id="line -"></span>
            -->
            <p><span id="line3-1">Гъат</span><span id="line3-2">хэр</span> <span id="line3-3">къос</span><span id="line3-4">ри</span>, 
            <span id="line3-5">удз</span><span id="line3-6">хэр</span> <span id="line3-7">къо</span><span id="line3-8">кӀ.</span></p>

            <p><span id="line4-1">Ghat</span><span id="line4-2">khär </span><span id="line4-3">q’os</span><span id="line4-4">ri, </span>
                <span id="line4-5">wdz</span><span id="line4-6">khär </span><span id="line4-7">q’o</span><span id="line4-8">k’.</span></p>
            </br>

            <p>ПцӀащхъуэ цӀыкӀухэр къолъэтэж.</p>
            <p>Pts’aśxwä ts’y2kw’khär q’olhätäzh.</p>
            </br>
            <p>ПцӀащхъуэ цӀыкӀухэр къытхуогуфӀэ,</p>
            <p>Pts’aśxwä ts’y2kw’khär q’y2tkhwogwf’ä,</p>
            </br>
            <p>ПыгуфӀыкӀхэу къытхуосыж.</p>
            <p>Py2gwf’y2k’khäw q’y2tkhwosy2zh.</p>
            </br>
            <p>ПцӀащхъуэ цӀыкӀуу зи бзэр дахэ,</p>
            <p>Pts’aśxwä ts’y2kw’w zi bzär dakhä,</p>
            </br>
            <p>Хугу уэстынщи, уэрэд жыӀэ.</p>
            <p>Khwgw wästy2nśi, wäräd zhy2ä.</p>
            </br>
            <p>ЩӀыпӀэ жыжьэм щыплъэгъуахэр</p>
            <p>Ś’y2p’ä zhy2źäm śy2plhäghwakhär</p>
            </br>
            <p>Пэжагъ хэлъу къыджеӀэж.</p>
            <p>Päzhagh khälhw q’y2dzhe’äzh.</p>
            </br>
            <p id="author">Елберд Хь</p>
            </br>
            </div>
<!-- 
            <div class="cell cell-2">
                <audio id="myAudio" src='./assets/audio/poem/swallow.mp3' preload="auto"></audio>
                 -->
                <!-- style="font-size: larger;" -->
<!--                 
                <span onClick="togglePlay()"> <i class="fa fa-volume-up fa-1x"></i></span>&nbsp;
                <span onClick="resetAudio()"><i class="fa fa-refresh" aria-hidden="true"></i></span> -->
<!-- 
                <div>
                    <span onClick="togglePlay()"><strong>Listen to Natives </strong><i class="fa fa-volume-up fa-1x"></i></span>
                    <span onClick="resetAudio()"><i class="fa fa-refresh" aria-hidden="true"></i></span>
                </div>

                </br> -->
<!-- 
            </div> -->

            <div class="cell cell-3">
                <p>Read and Record a Poem</p>
                <button class="mic-toggle" id="mic">
                    <span class="material-icons">mic</span>
                </button>
                <audio class="playback" controls></audio>
            </div>

            <div class="cell cell-4">
                <h1 style="font-size: larger;">Little Swallow</h1>
                </br>
                <p>Spring is coming, the grass is growing.</p>
                <!-- Маленькие ласточки прилетают снова -->
                <p>The little swallows are flying back again.</p> 
                <!-- Маленькие ласточки нас радуют, -->
                <p>Little swallows make us happy,</p>
                <!-- Улыбаясь до нас долетают. -->
                <p>Smiling they reach us.</p>
                <!-- Маленькая ласточка, чей голос красив, -->
                <p>Little swallow, whose voice is beautiful,</p>
                <!-- Когда дам тебе пшена, песню пой. -->
                <p>When I give you millet, sing a song.</p>
                <!-- Об увиденном в далеких странах  -->
                <p>About what you saw in distant countries</p>
                <!-- Нам правдиво раскажи. -->
                <p>Tell us truthfully.</p>
                </br>
                <p id="author">Elberd Kh’</p>
                </br>
            </div>

          </div>

    </main>
    
    <footer>
        <small>
            Circassian 2024
        </small>
    </footer>


<script>
let myAudio = document.getElementById("myAudio");
let isPlaying = false;
let timeoutIDs = []; // array to store timeout IDs

// object to store original colours
const originalColours = {};

function togglePlay() {
    if (isPlaying) {
        myAudio.pause();
        clearTimeouts(); // clear existing timeouts when pausing
    } else {
        myAudio.play();
        const wordTimes = {
            // Пцӏащхъуэ цӏыкӏу.
            "line1-1": 1.6,
            "line1-2": 2,
            "line1-3": 2.5,
            "line1-4": 2.7,

            // Pts’aśxwä ts’y2kw’.
            "line2-1": 4.5,
            "line2-2": 5,
            "line2-3": 5.5,
            "line2-4": 5.6,

            // Гъатхэр къосри, удзхэр къокӀ.
            "line3-1": 7.6,
            "line3-2": 7.9,
            "line3-3": 8.6,
            "line3-4": 9,
            "line3-5": 9.7,
            "line3-6": 10,
            "line3-7": 10.7,
            "line3-8": 11,

            // Ghatkhär q’osri, wdzkhär q’ok’.
            "line4-1": 13.4,
            "line4-2": 13.7,
            "line4-3": 14.4,
            "line4-4": 14.9,
            "line4-5": 15.5,
            "line4-6": 15.9,
            "line4-7": 16.2,
            "line4-8": 16.6

            // ПцӀащхъуэ цӀыкӀухэр къолъэтэж.

            // Pts’aśxwä ts’y2kw’khär q’olhätäzh.

            // ПцӀащхъуэ цӀыкӀухэр къытхуогуфӀэ,

            // Pts’aśxwä ts’y2kw’khär q’y2tkhwogwf’ä,

            // ПыгуфӀыкӀхэу къытхуосыж.

            // Py2gwf’y2k’khäw q’y2tkhwosy2zh.

            // ПцӀащхъуэ цӀыкӀуу зи бзэр дахэ,

            // Pts’aśxwä ts’y2kw’w zi bzär dakhä,

            // Хугу уэстынщи, уэрэд жыӀэ.

            // Khwgw wästy2nśi, wäräd zhy2ä.

            // ЩӀыпӀэ жыжьэм щыплъэгъуахэр

            // Ś’y2p’ä zhy2źäm śy2plhäghwakhär

            // Пэжагъ хэлъу къыджеӀэж.

            // Päzhagh khälhw q’y2dzhe’äzh.

        };
        Object.entries(wordTimes).forEach(([wordId, seconds]) => {
            const element = document.getElementById(wordId);
            // store original colour
            originalColours[wordId] = element.style.color;
            const timeoutID = setTimeout(function() {
                element.style.color = "#2d706c";
            }, (seconds - myAudio.currentTime) * 1000); // calculate remaining time
            timeoutIDs.push(timeoutID); // store timeout ID
        });
    }
    isPlaying = !isPlaying; // toggle isPlaying
}

// clear any existing timeouts when pausing the audio and create new timeouts when resuming the audio
function clearTimeouts() {
    // clear all stored timeouts
    timeoutIDs.forEach(id => {
        clearTimeout(id);
    });
    timeoutIDs = []; // clear the array
}

myAudio.onplaying = function() {
    isPlaying = true;
};

myAudio.onpause = function() {
    isPlaying = false;
};

function resetAudio() {
    myAudio.pause();
    myAudio.currentTime = 0;
    isPlaying = false;
    clearTimeouts(); // clear existing timeouts
    
    // restore original colours
    Object.entries(originalColours).forEach(([wordId, color]) => {
        document.getElementById(wordId).style.color = ""; // restore the default font colour
    });
}

</script>

<!-- links to js file -->
<script src="./assets/js/poem.js"></script>

</body>
</html>